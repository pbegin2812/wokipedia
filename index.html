<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Wokipédia — Encyclopédie des joueurs fictifs</title>
<link rel="icon" type="image/png" href="wokipédia.png">
<style>
@import url('https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap');
body, input, button, select, textarea { font-family: 'Lexend', sans-serif; margin:0; padding:0; box-sizing:border-box;}
:root{--bg:#fff;--muted:#6b6b6b;--accent:#1765c1;--card:#fbfdff;}
body{background:var(--bg);color:#111;}
header{background:#f4f7fb;padding:12px 24px;border-bottom:1px solid #e6eef9;display:flex;align-items:center;gap:12px;}
header img{width:40px;height:40px;cursor:pointer;}
.wrap{max-width:1100px;margin:20px auto;padding:0 20px;}
h1{margin:0;font-size:24px;}
.layout{display:grid;grid-template-columns:1fr;gap:20px;margin-top:20px;}
.card-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px;}
.card{background:#fff;border:1px solid #eef6ff;border-radius:8px;overflow:hidden;cursor:pointer;display:flex;flex-direction:column;align-items:center;text-align:center;transition:0.2s;padding:8px;}
.card:hover{box-shadow:0 2px 8px rgba(0,0,0,0.15);}
.card img{width:100%;height:auto;object-fit:cover;border-radius:6px;}
.add-card{background:#1765c1;color:#fff;display:flex;align-items:center;justify-content:center;font-size:40px;cursor:pointer;transition:0.2s;}
.add-card:hover{background:#0e4a8b;}
.form-container{background:#fff;padding:16px;border-radius:10px;max-width:720px;width:100%;margin:auto;}
.form{margin-top:14px;padding:12px;border-radius:8px;background:#fbfdff;border:1px solid #eef6ff;max-height:60vh;overflow-y:auto;}
label{display:block;font-size:13px;margin:6px 0 2px;}
input,textarea,select{width:100%;padding:8px;border:1px solid #dfeaf9;border-radius:6px;}
.flags{margin-top:4px;display:flex;gap:4px;flex-wrap:wrap;}
.flag-btn{cursor:pointer;padding:4px 8px;border:1px solid #d9e4f5;border-radius:6px;background:#f7faff;color:#111;font-size:14px;display:flex;align-items:center;gap:4px;transition:0.2s;}
.flag-btn img{width:20px;height:14px;object-fit:cover;}
.flag-btn:hover{background:#e1f0ff;}
#uploadBtn{background:#1765c1;color:#fff;padding:8px 14px;border-radius:6px;cursor:pointer;border:none;transition:0.2s;}
#uploadBtn:hover{background:#0e4a8b;}
.action-btn{background:#1765c1;color:#fff;padding:6px 12px;border-radius:6px;border:none;cursor:pointer;transition:0.2s;margin-right:6px;}
.action-btn:hover{background:#0e4a8b;}
#playerSearch{padding:8px;border:1px solid #d9e4f5;border-radius:6px;width:100%;margin-bottom:12px;}
</style>
</head>
<body>

<header>
  <img src="assets/wokipédia.png" alt="Accueil" onclick="showMenu()">
  <h1>Wokipédia</h1>
</header>

<div class="wrap" id="mainContainer">
  <!-- Menu principal ou fiche joueur insérée ici -->
</div>

<!-- Form modal -->
<div id="formbox" style="display:none;position:fixed;inset:0;background:rgba(10,20,40,0.45);align-items:center;justify-content:center;padding:20px">
  <div class="form-container">
    <h3>Ajouter / Modifier un joueur</h3>
    <div class="form">
      <label>Nom complet</label><input id="fn">
      <label>Pseudo (facultatif)</label><input id="pn">
      <label>Date de naissance</label>
      <div style="display:flex;gap:4px;">
        <select id="dob_day"></select>
        <select id="dob_month"></select>
        <select id="dob_year"></select>
      </div>
      <label>Lieu de naissance</label><input id="birth">
      <label>Nationalités / Pouvoirs</label>
      <div style="display:flex;gap:8px;margin-bottom:4px">
        <input id="powerInput" placeholder="Rechercher une nationalité/pouvoir..." style="flex:1">
        <button type="button" onclick="addPower()">Ajouter</button>
      </div>
      <div id="powerList" style="display:flex;flex-wrap:wrap;gap:6px;"></div>
      <label>Poste</label><input id="pos">
      <label>Carrière</label>
      <div id="careerBox">
        <div id="careerList"></div>
        <button type="button" onclick="addCareerRow()">+ Ajouter une étape</button>
      </div>
      <label>Image</label>
      <div style="display:flex;gap:8px;align-items:center">
        <button type="button" id="uploadBtn">Choisir une image</button>
        <span id="fileName" style="font-size:13px;color:#555"></span>
      </div>
      <input type="file" id="uploadImg" accept="image/*" style="display:none">
      <img id="preview" style="max-width:120px;margin-top:8px;display:block">
      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="action-btn" onclick="savePlayer()">Enregistrer</button>
        <button class="action-btn" style="background:#eee;color:#111;" onclick="closeForm()">Annuler</button>
      </div>
    </div>
  </div>
</div>

<script>
// --- Données
const players = {};
const powers = ["Force","Vitesse","Agilité","Intelligence","USA","France","Brésil","Espagne","Royaume-Uni"];

// --- Dates
const daySelect = document.getElementById('dob_day');
const monthSelect = document.getElementById('dob_month');
const yearSelect = document.getElementById('dob_year');
for(let d=1;d<=31;d++){ let o=document.createElement('option'); o.value=o.text=d; daySelect.appendChild(o);}
const months=["Jan","Fév","Mar","Avr","Mai","Juin","Juil","Août","Sep","Oct","Nov","Déc"];
months.forEach((m,i)=>{ let o=document.createElement('option'); o.value=i+1; o.text=m; monthSelect.appendChild(o);});
const currentYear = new Date().getFullYear();
for(let y=currentYear;y>=1900;y--){ let o=document.createElement('option'); o.value=o.text=y; yearSelect.appendChild(o);}

// --- LocalStorage
const saved = localStorage.getItem("wokipediaPlayers");
if(saved) Object.assign(players, JSON.parse(saved));
function saveToStorage(){ localStorage.setItem("wokipediaPlayers", JSON.stringify(players)); }

// --- Menu principal
function showMenu(){
  document.getElementById('formbox').style.display='none';
  const container=document.getElementById('mainContainer'); container.innerHTML='';

  // Search bar
  const searchInput=document.createElement('input');
  searchInput.id='playerSearch'; searchInput.placeholder='Rechercher un joueur...';
  searchInput.oninput=renderCards;
  container.appendChild(searchInput);

  const grid = document.createElement('div'); grid.className='card-grid';
  container.appendChild(grid);
  renderCards();

  function renderCards(){
    const q=searchInput.value.trim().toLowerCase();
    grid.innerHTML='';
    Object.keys(players).filter(k=>k.toLowerCase().includes(q)||players[k].pseudo.toLowerCase().includes(q)).forEach(key=>{
      const p=players[key];
      const card=document.createElement('div'); card.className='card';
      card.onclick=()=>showPlayer(key);
      card.innerHTML=`<img src="${p.image||'assets/Lettre _W_ en noir et blanc.png'}"><strong>${p.fullname}</strong><br>${p.pseudo||''}`;
      grid.appendChild(card);
    });
    const addCard = document.createElement('div'); addCard.className='card add-card'; addCard.innerHTML='+'; addCard.onclick=openAdd;
    grid.appendChild(addCard);
  }
}

// --- Ajouter un joueur
function openAdd(){ clearForm(); document.getElementById('formbox').style.display='flex'; }
function closeForm(){document.getElementById('formbox').style.display='none';}

// --- Formulaire powers
function addPower(){
  const val=document.getElementById('powerInput').value.trim(); if(!val) return;
  const list=document.getElementById('powerList');
  const div=document.createElement('div'); div.style.padding='4px'; div.style.background='#f0f5ff'; div.style.border='1px solid #d0e0ff'; div.style.borderRadius='4px'; div.style.display='flex'; div.style.alignItems='center'; div.style.gap='4px';
  const span=document.createElement('span'); span.textContent=val;
  const btn=document.createElement('button'); btn.textContent='×'; btn.style.border='none'; btn.style.background='transparent'; btn.style.cursor='pointer'; btn.onclick=()=>list.removeChild(div);
  div.appendChild(span); div.appendChild(btn); list.appendChild(div);
  document.getElementById('powerInput').value='';
}

// --- Carrière
function addCareerRow(data={}){const row=document.createElement("div"); row.style.display="grid"; row.style.gridTemplateColumns="120px 1fr 80px 80px"; row.style.gap="6px"; row.style.marginBottom="4px";
const inputPeriod=document.createElement("input"); inputPeriod.placeholder="2009–2010"; inputPeriod.value=data[0]||"";
const inputClub=document.createElement("input"); inputClub.placeholder="Club (ex: !loan Chelsea)"; inputClub.value=data[1]||"";
const inputMatches=document.createElement("input"); inputMatches.type="number"; inputMatches.placeholder="Matchs"; inputMatches.value=data[2]||"";
const inputGoals=document.createElement("input"); inputGoals.type="number"; inputGoals.placeholder="Buts"; inputGoals.value=data[3]||"";
row.append(inputPeriod,inputClub,inputMatches,inputGoals); document.getElementById("careerList").appendChild(row);}
function parseCareer(){ return Array.from(document.querySelectorAll("#careerList div")).map(r=>{ const [period,club,matches,goals]=[...r.querySelectorAll("input")].map(i=>i.value.trim()); return [period,club,matches,goals];});}

// --- Upload image
document.getElementById('uploadBtn').addEventListener('click',()=>document.getElementById('uploadImg').click());
document.getElementById('uploadImg').addEventListener('change',e=>{ const file=e.target.files[0]; if(file){ const url=URL.createObjectURL(file); document.getElementById('preview').src=url; document.getElementById('fileName').textContent=file.name; } });

// --- Sauvegarde
function savePlayer(){
  const fn=document.getElementById('fn').value.trim(); if(!fn){alert('Nom requis'); return;}
  const pseudo=document.getElementById('pn').value.trim();
  const dob=`${daySelect.value}/${monthSelect.value}/${yearSelect.value}`;
  const birth=document.getElementById('birth').value.trim();
  const pos=document.getElementById('pos').value.trim();
  const career=parseCareer();
  const powers=Array.from(document.querySelectorAll('#powerList span')).map(s=>s.textContent);
  const img=document.getElementById('preview').src||'';
  let matches=0, goals=0; career.forEach(r=>{ matches+=parseInt(r[2])||0; goals+=parseInt(r[3])||0; });
  players[fn]={ fullname:fn, pseudo:pseudo||'', dob, birth, pos, career, powers, image:img, totals:{matches,goals} };
  saveToStorage(); closeForm(); showMenu();
}

// --- Fiche joueur
function showPlayer(key){
  const p=players[key]; const container=document.getElementById('mainContainer'); container.innerHTML='';
  const div=document.createElement('div'); div.className='form-container';
  let powersHtml=''; if(p.powers) p.powers.forEach(po=>powersHtml+=`<div class="flag-btn"><img src="assets/${po}.png" alt="${po}">${po}</div>`);
  let careerHtml='<table><thead><tr><th>Période</th><th>Club</th><th>Matchs</th><th>Buts</th></tr></thead><tbody>'; if(p.career) p.career.forEach(r=>{ let club=r[1].startsWith('!loan')?'→ '+r[1].replace('!loan','').trim():r[1]; careerHtml+=`<tr><td>${r[0]}</td><td>${club}</td><td>${r[2]}</td><td>${r[3]}</td></tr>`;}); careerHtml+='</tbody></table>';
  div.innerHTML=`<div style="display:flex;gap:12px;align-items:center"><div style="width:96px;height:128px;background:#eee;border-radius:4px;overflow:hidden"><img src="${p.image}" style="width:100%;height:100%;object-fit:cover"></div>
  <div><h2>${p.fullname}</h2>${p.pseudo?'<span>'+p.pseudo+'</span>':''}<br><span>${p.pos} • ${p.dob} • ${p.birth}</span></div></div>
  <div class="flags">${powersHtml}</div>
  ${careerHtml}
  <div><strong>Totaux :</strong> ${p.totals.matches} matchs — ${p.totals.goals} buts</div>
  <div style="margin-top:12px;"><button class="action-btn" onclick="openEdit('${key}')">Modifier</button> <button class="action-btn" onclick="showMenu()">Retour</button></div>`;
  container.appendChild(div);
}

// --- Edit
function openEdit(key){ showPlayer(key); openAdd(); const p=players[key]; document.getElementById('fn').value=p.fullname; document.getElementById('pn').value=p.pseudo; document.getElementById('pos').value=p.pos; document.getElementById('preview').src=p.image; daySelect.value=p.dob.split('/')[0]; monthSelect.value=p.dob.split('/')[1]; yearSelect.value=p.dob.split('/')[2]; document.getElementById('birth').value=p.birth; document.getElementById('careerList').innerHTML=''; if(p.career)p.career.forEach(addCareerRow); document.getElementById('powerList').innerHTML=''; if(p.powers)p.powers.forEach(addPower); }

// --- Initial
showMenu();
</script>
</body>
</html>
