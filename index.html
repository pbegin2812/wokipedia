<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>WokipÃ©dia â€” EncyclopÃ©die des joueurs fictifs</title>
<link rel="icon" type="image/png" href="assets/Lettre _W_ en noir et blanc.png">
<style>
@import url('https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap');
body, input, button, select, textarea { font-family: 'Lexend', sans-serif; margin:0; padding:0; box-sizing:border-box;}
:root{--bg:#fff;--accent:#1765c1;}
body{background:var(--bg);color:#111;}
header{background:#f4f7fb;padding:12px 24px;border-bottom:1px solid #e6eef9;display:flex;align-items:center;gap:12px;}
header img{width:40px;height:40px;cursor:pointer;}
.wrap{max-width:1100px;margin:20px auto;padding:0 20px;}
h1{margin:0;font-size:24px;}
.card-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px;}
.card{background:#fff;border:1px solid #eef6ff;border-radius:8px;overflow:hidden;cursor:pointer;display:flex;flex-direction:column;align-items:center;text-align:center;transition:0.2s;padding:8px;}
.card:hover{box-shadow:0 2px 8px rgba(0,0,0,0.15);}
.card img{width:100%;height:auto;object-fit:cover;border-radius:6px;}
.add-card{background:#1765c1;color:#fff;display:flex;align-items:center;justify-content:center;font-size:40px;cursor:pointer;}
.add-card:hover{background:#0e4a8b;}
.form-container{background:#fff;padding:16px;border-radius:10px;max-width:720px;width:100%;margin:auto;}
label{display:block;font-size:13px;margin:6px 0 2px;}
input,textarea,select{width:100%;padding:8px;border:1px solid #dfeaf9;border-radius:6px;}
#uploadBtn{background:#1765c1;color:#fff;padding:8px 14px;border-radius:6px;cursor:pointer;border:none;}
#uploadBtn:hover{background:#0e4a8b;}
.action-btn{background:#1765c1;color:#fff;padding:6px 12px;border-radius:6px;border:none;cursor:pointer;transition:0.2s;margin-right:6px;}
.action-btn:hover{background:#0e4a8b;}
#playerSearch{padding:8px;border:1px solid #d9e4f5;border-radius:6px;width:100%;margin-bottom:12px;}
</style>
</head>
<body>

<header>
  <img src="assets/wokipÃ©dia.png" alt="Accueil" onclick="showMenu()">
  <h1>WokipÃ©dia</h1>
</header>

<div class="wrap" id="mainContainer"></div>

<!-- Form modal -->
<div id="formbox" style="display:none;position:fixed;inset:0;background:rgba(10,20,40,0.45);align-items:center;justify-content:center;padding:20px">
  <div class="form-container">
    <h3 id="formTitle">Ajouter un joueur</h3>
    <div>
      <label>Nom complet</label><input id="fn">
      <label>Pseudo (facultatif)</label><input id="pn">
      <label>Date de naissance</label>
      <div style="display:flex;gap:4px;">
        <select id="dob_day"></select>
        <select id="dob_month"></select>
        <select id="dob_year"></select>
      </div>
      <label>Lieu de naissance</label><input id="birth">
      <label>Poste</label><input id="pos">
      <label>CarriÃ¨re</label>
      <div id="careerList"></div>
      <button type="button" onclick="addCareerRow()">+ Ajouter une Ã©tape</button>
      <label>Image</label>
      <div style="display:flex;gap:8px;align-items:center">
        <button type="button" id="uploadBtn">Choisir une image</button>
        <span id="fileName" style="font-size:13px;color:#555"></span>
      </div>
      <input type="file" id="uploadImg" accept="image/*" style="display:none">
      <img id="preview" style="max-width:120px;margin-top:8px;display:block">
      <div style="margin-top:12px;">
        <button class="action-btn" onclick="savePlayer()">Enregistrer</button>
        <button class="action-btn" style="background:#eee;color:#111;" onclick="closeForm()">Annuler</button>
      </div>
    </div>
  </div>
</div>

<script>
const players = {};
let editingKey = null; // ðŸ”‘ savoir si on Ã©dite
// dates
const daySelect = document.getElementById('dob_day');
const monthSelect = document.getElementById('dob_month');
const yearSelect = document.getElementById('dob_year');
for(let d=1;d<=31;d++){ let o=new Option(d,d); daySelect.add(o);}
["Jan","FÃ©v","Mar","Avr","Mai","Juin","Juil","AoÃ»t","Sep","Oct","Nov","DÃ©c"].forEach((m,i)=>monthSelect.add(new Option(m,i+1)));
for(let y=new Date().getFullYear();y>=1900;y--){ yearSelect.add(new Option(y,y)); }
// storage
const saved = localStorage.getItem("wokipediaPlayers");
if(saved) Object.assign(players, JSON.parse(saved));
function saveToStorage(){ localStorage.setItem("wokipediaPlayers", JSON.stringify(players)); }
// menu
function showMenu(){
  document.getElementById('formbox').style.display='none';
  const container=document.getElementById('mainContainer'); container.innerHTML='';
  const search=document.createElement('input'); search.id='playerSearch'; search.placeholder='Rechercher un joueur...'; search.oninput=render; container.appendChild(search);
  const grid=document.createElement('div'); grid.className='card-grid'; container.appendChild(grid);
  render();
  function render(){
    const q=search.value.toLowerCase(); grid.innerHTML='';
    Object.keys(players).filter(k=>k.toLowerCase().includes(q)||players[k].pseudo.toLowerCase().includes(q)).forEach(k=>{
      const p=players[k];
      const card=document.createElement('div'); card.className='card'; card.onclick=()=>showPlayer(k);
      card.innerHTML=`<img src="${p.image||'assets/Lettre _W_ en noir et blanc.png'}"><strong>${p.fullname}</strong><br>${p.pseudo||''}`;
      grid.appendChild(card);
    });
    const add=document.createElement('div'); add.className='card add-card'; add.textContent='+'; add.onclick=openAdd; grid.appendChild(add);
  }
}
// form
function openAdd(){ clearForm(); editingKey=null; document.getElementById('formTitle').textContent="Ajouter un joueur"; document.getElementById('formbox').style.display='flex'; }
function openEdit(key){ clearForm(); editingKey=key; const p=players[key]; document.getElementById('formTitle').textContent="Modifier le joueur"; document.getElementById('fn').value=p.fullname; document.getElementById('pn').value=p.pseudo; document.getElementById('birth').value=p.birth; document.getElementById('pos').value=p.pos; const [d,m,y]=p.dob.split('/'); daySelect.value=d; monthSelect.value=m; yearSelect.value=y; document.getElementById('careerList').innerHTML=''; if(p.career)p.career.forEach(r=>addCareerRow(r)); document.getElementById('preview').src=p.image; document.getElementById('formbox').style.display='flex'; }
function closeForm(){document.getElementById('formbox').style.display='none';}
function clearForm(){ document.getElementById('fn').value=''; document.getElementById('pn').value=''; document.getElementById('birth').value=''; document.getElementById('pos').value=''; document.getElementById('careerList').innerHTML=''; document.getElementById('preview').src=''; document.getElementById('fileName').textContent=''; daySelect.value=1; monthSelect.value=1; yearSelect.value=new Date().getFullYear(); }
function addCareerRow(data=["","","",""]){ const row=document.createElement("div"); row.style.display="grid"; row.style.gridTemplateColumns="120px 1fr 80px 80px"; row.style.gap="4px"; row.style.marginBottom="4px"; ["PÃ©riode","Club","Matchs","Buts"].forEach((ph,i)=>{ const inp=document.createElement("input"); inp.value=data[i]||""; inp.placeholder=ph; if(i>=2)inp.type="number"; row.appendChild(inp); }); document.getElementById("careerList").appendChild(row);}
function parseCareer(){ return Array.from(document.querySelectorAll("#careerList div")).map(r=>[...r.querySelectorAll("input")].map(i=>i.value.trim())); }
// upload
document.getElementById('uploadBtn').onclick=()=>document.getElementById('uploadImg').click();
document.getElementById('uploadImg').onchange=e=>{const f=e.target.files[0]; if(f){const url=URL.createObjectURL(f); document.getElementById('preview').src=url; document.getElementById('fileName').textContent=f.name; }}
// save
function savePlayer(){
  const fn=document.getElementById('fn').value.trim(); if(!fn){alert('Nom requis'); return;}
  const pseudo=document.getElementById('pn').value.trim();
  const dob=`${daySelect.value}/${monthSelect.value}/${yearSelect.value}`;
  const birth=document.getElementById('birth').value.trim();
  const pos=document.getElementById('pos').value.trim();
  const career=parseCareer();
  const img=document.getElementById('preview').src||'';
  let matches=0, goals=0; career.forEach(r=>{ matches+=parseInt(r[2])||0; goals+=parseInt(r[3])||0; });
  const data={ fullname:fn, pseudo, dob, birth, pos, career, image:img, totals:{matches,goals} };
  // mode Ã©dition ou ajout
  const key = editingKey || fn;
  players[key]=data;
  saveToStorage();
  closeForm();
  showMenu();
}
// fiche joueur
function showPlayer(key){
  const p=players[key]; const c=document.getElementById('mainContainer'); c.innerHTML='';
  const div=document.createElement('div'); div.className='form-container';
  let careerHtml='<table><thead><tr><th>PÃ©riode</th><th>Club</th><th>Matchs</th><th>Buts</th></tr></thead><tbody>';
  if(p.career)p.career.forEach(r=>{ careerHtml+=`<tr><td>${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td><td>${r[3]}</td></tr>`; }); careerHtml+='</tbody></table>';
  div.innerHTML=`<div style="display:flex;gap:12px;align-items:center"><div style="width:96px;height:128px;background:#eee;overflow:hidden"><img src="${p.image}" style="width:100%;height:100%;object-fit:cover"></div>
  <div><h2>${p.fullname}</h2>${p.pseudo?'<span>'+p.pseudo+'</span>':''}<br><span>${p.pos} â€¢ ${p.dob} â€¢ ${p.birth}</span></div></div>
  ${careerHtml}
  <div><strong>Totaux :</strong> ${p.totals.matches} matchs â€” ${p.totals.goals} buts</div>
  <div style="margin-top:12px;"><button class="action-btn" onclick="openEdit('${key}')">Modifier</button> <button class="action-btn" onclick="showMenu()">Retour</button></div>`;
  c.appendChild(div);
}
// init
showMenu();
</script>
</body>
</html>
