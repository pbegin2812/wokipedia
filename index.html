<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Wokipédia — Encyclopédie des joueurs fictifs</title>
<link rel="icon" type="image/png" href="assets/wokipédia.png">
<style>
@import url('https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap');

body, input, button, select, textarea { font-family: 'Lexend', sans-serif; }
:root{--bg:#fff;--muted:#6b6b6b;--accent:#1765c1;--card:#fbfdff}
body{margin:0;background:var(--bg);color:#111}
header{background:#f4f7fb;padding:18px 24px;border-bottom:1px solid #e6eef9}
.wrap{max-width:1100px;margin:20px auto;padding:0 20px}
h1{margin:0;font-size:24px}
.searchbar{margin-top:12px;display:flex;gap:8px}
input[type=search]{flex:1;padding:10px 12px;border:1px solid #d9e4f5;border-radius:6px;font-size:15px}
button{padding:10px 12px;border-radius:6px;border:0;background:var(--accent);color:#fff;cursor:pointer;transition:0.2s}
button:hover{background:#0e4a8b}
.layout{display:grid;grid-template-columns:320px 1fr;gap:20px;margin-top:20px}
.sidebar{background:var(--card);padding:14px;border-radius:8px;border:1px solid #e9f0fb;max-height:80vh;overflow-y:auto}
.player-list{list-style:none;padding:0;margin:0}
.player-list li{padding:8px 6px;border-bottom:1px solid #f0f5fb;cursor:pointer}
.player-list li:hover{background:#f7fbff}
.content{background:#fff;padding:18px;border-radius:8px;border:1px solid #eef6ff;min-height:420px;max-height:70vh;overflow-y:auto}
.card-header{display:flex;gap:12px;align-items:center}
.avatar{width:96px;height:128px;background:#eee;border-radius:4px;overflow:hidden}
.avatar img{width:100%;height:100%;object-fit:cover}
.meta{flex:1}
table{border-collapse:collapse;width:100%;margin-top:12px}
td,th{padding:6px 8px;border:1px solid #f0f5fb}
.muted{color:var(--muted);font-size:14px}
.controls{display:flex;gap:8px;margin-top:12px}
.form{margin-top:14px;padding:12px;border-radius:8px;background:#fbfdff;border:1px solid #eef6ff;max-height:60vh;overflow-y:auto}
label{display:block;font-size:13px;margin:6px 0 2px}
input,textarea,select{width:100%;padding:8px;border:1px solid #dfeaf9;border-radius:6px}
.flags{margin-top:4px;display:flex;gap:4px;flex-wrap:wrap}
.flag-btn{cursor:pointer;padding:4px 8px;border:1px solid #d9e4f5;border-radius:6px;background:#f7faff;color:#111;font-size:14px;display:flex;align-items:center;gap:4px;transition:0.2s}
.flag-btn img{width:20px;height:14px;object-fit:cover}
.flag-btn:hover{background:#e1f0ff}
#powerList div{padding:4px 8px;background:#f0f5ff;border:1px solid #d0e0ff;border-radius:4px;display:flex;align-items:center;gap:4px;margin-bottom:4px;}
#uploadBtn{background:#1765c1;color:#fff;padding:8px 14px;border-radius:6px;cursor:pointer;border:none;transition:0.2s}
#uploadBtn:hover{background:#0e4a8b}
@media (max-width:900px){.layout{grid-template-columns:1fr}.sidebar{order:2}}
</style>
</head>
<body>

<header>
  <div class="wrap">
    <h1>Wokipédia — Encyclopédie des joueurs fictifs</h1>
    <div class="searchbar">
      <input id="search" type="search" placeholder="Rechercher un joueur..." oninput="renderList()">
      <button onclick="openAdd()">Ajouter un joueur</button>
    </div>
  </div>
</header>

<div class="wrap layout">
  <aside class="sidebar">
    <h3>Joueurs</h3>
    <ul id="list" class="player-list" role="listbox" tabindex="0"></ul>
    <div class="muted" style="margin-top:12px">Clique sur un joueur pour voir sa page. Tes fiches sont sauvegardées dans ton navigateur.</div>
  </aside>

  <section class="content" id="detail">
    <div class="muted">Sélectionne un joueur dans la colonne de gauche ou recherche par nom.</div>
  </section>
</div>

<div id="formbox" style="display:none;position:fixed;inset:0;background:rgba(10,20,40,0.45);align-items:center;justify-content:center;padding:20px">
  <div style="background:#fff;padding:16px;border-radius:10px;max-width:720px;width:100%">
    <h3>Ajouter / Modifier un joueur</h3>
    <div class="form">
      <label>Nom complet</label><input id="fn">
      <label>Pseudo</label><input id="pn">
      <label>Date de naissance</label><input id="dob" placeholder="JJ/MM/AAAA">
      <label>Lieu de naissance</label><input id="birth">
      
      <label>Nationalités / Pouvoirs</label>
      <div style="display:flex;gap:8px;margin-bottom:4px">
        <input id="powerInput" placeholder="Rechercher une nationalité/pouvoir..." style="flex:1">
        <button type="button" onclick="addPower()">Ajouter</button>
      </div>
      <div id="powerList" style="display:flex;flex-wrap:wrap;gap:6px;"></div>

      <label>Poste</label><input id="pos">

      <label>Carrière</label>
      <div id="careerBox">
        <div id="careerList"></div>
        <button type="button" onclick="addCareerRow()">+ Ajouter une étape</button>
      </div>

      <label>Image</label>
      <div style="display:flex;gap:8px;align-items:center">
        <button type="button" id="uploadBtn">Choisir une image</button>
        <span id="fileName" style="font-size:13px;color:#555"></span>
      </div>
      <input type="file" id="uploadImg" accept="image/*" style="display:none">
      <img id="preview" style="max-width:120px;margin-top:8px;display:block">

      <div style="display:flex;gap:8px;margin-top:10px">
        <button onclick="savePlayer()">Enregistrer</button>
        <button onclick="closeForm()" style="background:#eee;color:#111">Annuler</button>
      </div>
    </div>
  </div>
</div>

<script>
// --- Données initiales
const players = {
  "Palinho":{
    fullname:"Agani Parkson",
    pseudo:"Palinho",
    dob:"30/07/1992",
    birth:"London, England",
    powers:["France","USA","Force"],
    pos:"Attaquant",
    image:"",
    career:[
      ["2009–2010","Southampton","22","7"],
      ["2010–2014","Hull City","61","20"],
      ["2011–2012","!loan Manchester United","15","5"]
    ],
    totals:{matches:98,goals:32}
  }
};

// --- Commandes pays / drapeaux
const countryCommands = {"!france":"France","!usa":"USA","!uk":"Royaume-Uni","!brazil":"Brésil","!spain":"Espagne"};
function getFlagSrc(name){ return `assets/${name}.png`; }

// --- Pouvoirs/Nationalités autocomplete
const powers = ["Force","Vitesse","Agilité","Intelligence","USA","France","Brésil","Espagne","Royaume-Uni"];

// --- LocalStorage
const saved = localStorage.getItem("wokipediaPlayers");
if(saved) Object.assign(players, JSON.parse(saved));
function saveToStorage(){ localStorage.setItem("wokipediaPlayers", JSON.stringify(players)); }

// --- Liste joueurs
function renderList(){
  const q = document.getElementById('search').value.trim().toLowerCase();
  const list = document.getElementById('list'); list.innerHTML='';
  Object.keys(players).filter(k=>k.toLowerCase().includes(q) || players[k].fullname.toLowerCase().includes(q)).sort()
    .forEach(name=>{
      const li = document.createElement('li');
      li.textContent = name + ' — ' + (players[name].pseudo||'');
      li.onclick = ()=>showPlayer(name);
      list.appendChild(li);
    });
  if(list.children.length===0){ const li=document.createElement('li'); li.textContent='Aucun joueur trouvé'; li.style.color='#888'; list.appendChild(li);}
}

// --- Affichage profil joueur
function showPlayer(key){
  const p = players[key]; 
  const container = document.getElementById('detail'); 
  container.innerHTML='';

  const header = document.createElement('div'); 
  header.className='card-header';

  const avatar = document.createElement('div'); 
  avatar.className='avatar';
  const img = document.createElement('img'); 
  img.src=p.image||''; 
  avatar.appendChild(img);

  const meta = document.createElement('div'); 
  meta.className='meta';
  meta.innerHTML=`<h2>${key} <span style="font-size:14px;color:#666">(${p.fullname})</span></h2>
                   <div class="muted">${p.pos} • Né(e) ${p.dob} • ${p.birth}</div>`;
  header.appendChild(avatar); 
  header.appendChild(meta); 
  container.appendChild(header);

  // --- Section des drapeaux/noms sous infos du joueur
  const powersDiv = document.createElement('div'); 
  powersDiv.id = 'playerPowers'; 
  powersDiv.className = 'flags';
  powersDiv.style.marginTop = '8px';
  container.appendChild(powersDiv);

  // Ajouter chaque pouvoir/nationalité
  (p.powers||[]).forEach(c=>{
    addPowerToProfile(c,powersDiv);
  });

  // --- Carrière
  const t = document.createElement('table');
  t.innerHTML='<thead><tr><th>Période</th><th>Club</th><th>Matchs</th><th>Buts</th></tr></thead>';
  const tb = document.createElement('tbody');
  (p.career||[]).forEach(row=>{
    const tr=document.createElement('tr');
    let club=row[1].startsWith('!loan') ? '→ '+row[1].replace('!loan','').trim() : row[1];
    [row[0],club,row[2],row[3]].forEach(v=>{const td=document.createElement('td'); td.textContent=v; tr.appendChild(td);});
    tb.appendChild(tr);
  });
  t.appendChild(tb); 
  container.appendChild(t);

  const tot = document.createElement('div'); 
  tot.style.marginTop='12px';
  tot.innerHTML=`<strong>Totaux :</strong> ${p.totals.matches} matchs — ${p.totals.goals} buts`;
  container.appendChild(tot);

  const controls = document.createElement('div'); 
  controls.className='controls';
  const btnEdit = document.createElement('button'); 
  btnEdit.textContent='Modifier'; 
  btnEdit.onclick = ()=>openEdit(key);
  controls.appendChild(btnEdit); 
  container.appendChild(controls);
}

// --- Ajouter un pouvoir/nationalité à l'affichage du profil
function addPowerToProfile(name, container){
  const div = document.createElement('div');
  div.style.display = 'flex'; 
  div.style.alignItems = 'center'; 
  div.style.gap = '4px'; 
  div.style.padding = '2px 6px'; 
  div.style.border = '1px solid #d0e0ff'; 
  div.style.borderRadius = '4px'; 
  div.style.marginRight = '4px';
  
  const img = document.createElement('img');
  img.src = `assets/${name}.png`; 
  img.alt = name; 
  img.style.width='20px'; 
  img.style.height='14px';
  
  const span = document.createElement('span'); 
  span.textContent = name;
  
  div.appendChild(img); 
  div.appendChild(span);
  container.appendChild(div);
}

// --- Ajouter un pouvoir/nationalité via formulaire
function addPower(val){
  val = val || document.getElementById('powerInput').value.trim(); 
  if(!val) return;
  const list = document.getElementById('powerList'); 
  const div = document.createElement('div');
  const span = document.createElement('span'); span.textContent = val;
  const note = document.createElement('input'); note.type="number"; note.min="0"; note.max="10"; note.placeholder="note"; note.style.width="40px";
  const btn = document.createElement('button'); btn.textContent="×"; btn.style.border="none"; btn.style.background="transparent"; btn.style.cursor="pointer"; 
  btn.onclick=()=>list.removeChild(div);
  div.append(span,note,btn); 
  list.appendChild(div); 
  document.getElementById('powerInput').value="";
  
  const profileDiv = document.getElementById('playerPowers');
  if(profileDiv) addPowerToProfile(val, profileDiv);
}

// --- Autocomplete
document.querySelector('button[onclick="addPower()"]').addEventListener('click',()=>addPower());
document.getElementById('powerInput').addEventListener('input',()=>{ const val=document.getElementById('powerInput').value.toLowerCase(); const s=powers.find(p=>p.toLowerCase().startsWith(val)); if(s) document.getElementById('powerInput').value=s;});

// --- Carrière dynamique
function addCareerRow(data={}){const row=document.createElement("div"); row.style.display="grid"; row.style.gridTemplateColumns="120px 1fr 80px 80px"; row.style.gap="6px"; row.style.marginBottom="4px";
const inputPeriod=document.createElement("input"); inputPeriod.placeholder="2009–2010"; inputPeriod.value=data[0]||"";
const inputClub=document.createElement("input"); inputClub.placeholder="Club (ex: !loan Chelsea)"; inputClub.value=data[1]||"";
const inputMatches=document.createElement("input"); inputMatches.type="number"; inputMatches.placeholder="Matchs"; inputMatches.value=data[2]||"";
const inputGoals=document.createElement("input"); inputGoals.type="number"; inputGoals.placeholder="Buts"; inputGoals.value=data[3]||"";
row.appendChild(inputPeriod); row.appendChild(inputClub); row.appendChild(inputMatches); row.appendChild(inputGoals);
document.getElementById("careerList").appendChild(row);}
function parseCareer(){ const rows=document.querySelectorAll("#careerList div"); return Array.from(rows).map(r=>{ const [period,club,matches,goals]=[...r.querySelectorAll("input")].map(i=>i.value.trim()); return [period,club,matches,goals];});}

// --- Formulaire
function openAdd(){document.getElementById('formbox').style.display='flex'; clearForm();}
function openEdit(key){document.getElementById('formbox').style.display='flex'; clearForm();
const p = players[key]; document.getElementById('fn').value=p.fullname||''; document.getElementById('pn').value=key||''; document.getElementById('dob').value=p.dob||''; document.getElementById('birth').value=p.birth||''; document.getElementById('pos').value=p.pos||''; document.getElementById('preview').src=p.image||'';
(p.career||[]).forEach(row=>addCareerRow(row)); (p.powers||[]).forEach(c=>addPower(c));}
function clearForm(){['fn','pn','dob','birth','pos','powerInput'].forEach(id=>document.getElementById(id).value=''); document.getElementById('careerList').innerHTML=''; document.getElementById('powerList').innerHTML=''; document.getElementById('preview').src='';}
function closeForm(){document.getElementById('formbox').style.display='none';}

// --- Upload image
document.getElementById('uploadBtn').addEventListener('click',()=>document.getElementById('uploadImg').click());
document.getElementById('uploadImg').addEventListener('change', e => { const file=e.target.files[0]; if(file){ const url=URL.createObjectURL(file); document.getElementById('preview').src=url; document.getElementById('fileName').textContent=file.name; } });

// --- Sauvegarde
function savePlayer(){
  const key=document.getElementById('pn').value.trim(); if(!key){alert('Le pseudo est requis'); return;}
  const p={ fullname:document.getElementById('fn').value.trim(), pseudo:key, dob:document.getElementById('dob').value.trim(), birth:document.getElementById('birth').value.trim(), pos:document.getElementById('pos').value.trim(), image:document.getElementById('preview').src||'', career:parseCareer(), powers:Array.from(document.querySelectorAll('#powerList span')).map(s=>s.textContent) };
  let matches=0, goals=0; p.career.forEach(r=>{matches+=parseInt(r[2])||0; goals+=parseInt(r[3])||0;}); p.totals={matches,goals}; players[key]=p;
  saveToStorage(); closeForm(); renderList(); showPlayer(key);
}

// --- Initial render
renderList();
</script>
</body>
</html>
