<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>WokipÃ©dia â€” EncyclopÃ©die des joueurs fictifs</title>
<link rel="icon" type="image/png" href="assets/Lettre _W_ en noir et blanc.png">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap');

  body, input, button, select, textarea { font-family: 'Lexend', sans-serif; }
  :root{--bg:#fff;--muted:#6b6b6b;--accent:#1765c1;--card:#fbfdff}
  body{margin:0;background:var(--bg);color:#111}
  header{background:#f4f7fb;padding:18px 24px;border-bottom:1px solid #e6eef9}
  .wrap{max-width:1100px;margin:20px auto;padding:0 20px}
  h1{margin:0;font-size:24px}
  .searchbar{margin-top:12px;display:flex;gap:8px}
  input[type=search]{flex:1;padding:10px 12px;border:1px solid #d9e4f5;border-radius:6px;font-size:15px}
  button{padding:10px 12px;border-radius:6px;border:0;background:var(--accent);color:#fff;cursor:pointer}
  .layout{display:grid;grid-template-columns:320px 1fr;gap:20px;margin-top:20px}
  .sidebar{background:var(--card);padding:14px;border-radius:8px;border:1px solid #e9f0fb;max-height:80vh;overflow-y:auto}
  .player-list{list-style:none;padding:0;margin:0}
  .player-list li{padding:8px 6px;border-bottom:1px solid #f0f5fb;cursor:pointer}
  .player-list li:hover{background:#f7fbff}
  .content{background:#fff;padding:18px;border-radius:8px;border:1px solid #eef6ff;min-height:420px;max-height:70vh;overflow-y:auto}
  .card-header{display:flex;gap:12px;align-items:center}
  .avatar{width:96px;height:128px;background:#eee;border-radius:4px;overflow:hidden}
  .avatar img{width:100%;height:100%;object-fit:cover}
  .meta{flex:1}
  table{border-collapse:collapse;width:100%;margin-top:12px}
  td,th{padding:6px 8px;border:1px solid #f0f5fb}
  .muted{color:var(--muted);font-size:14px}
  .controls{display:flex;gap:8px;margin-top:12px}
  .form{margin-top:14px;padding:12px;border-radius:8px;background:#fbfdff;border:1px solid #eef6ff;max-height:50vh;overflow-y:auto}
  label{display:block;font-size:13px;margin:6px 0 2px}
  input,textarea,select{width:100%;padding:8px;border:1px solid #dfeaf9;border-radius:6px}
  .flags{margin-top:4px;display:flex;gap:4px;flex-wrap:wrap}
  .flag-btn{cursor:pointer;padding:2px 6px;border:1px solid #d9e4f5;border-radius:4px;background:#f7faff;color:#111;font-size:14px}
  @media (max-width:900px){.layout{grid-template-columns:1fr}.sidebar{order:2}}
</style>
</head>
<body>

<header>
  <div class="wrap">
    <h1>WokipÃ©dia â€” EncyclopÃ©die des joueurs fictifs</h1>
    <div class="searchbar">
      <input id="search" type="search" placeholder="Rechercher un joueur..." oninput="renderList()">
      <button onclick="openAdd()">Ajouter un joueur</button>
    </div>
  </div>
</header>

<div class="wrap layout">
  <aside class="sidebar">
    <h3>Joueurs</h3>
    <ul id="list" class="player-list" role="listbox" tabindex="0"></ul>
    <div class="muted" style="margin-top:12px">Clique sur un joueur pour voir sa page. Tes fiches sont sauvegardÃ©es dans ton navigateur.</div>
  </aside>

  <section class="content" id="detail">
    <div class="muted">SÃ©lectionne un joueur dans la colonne de gauche ou recherche par nom.</div>
  </section>
</div>

<div id="formbox" style="display:none;position:fixed;inset:0;background:rgba(10,20,40,0.45);align-items:center;justify-content:center;padding:20px">
  <div style="background:#fff;padding:16px;border-radius:10px;max-width:720px;width:100%">
    <h3>Ajouter / Modifier un joueur</h3>
    <div class="form">
      <label>Nom complet</label><input id="fn">
      <label>Pseudo</label><input id="pn">
      <label>Date de naissance</label><input id="dob" placeholder="JJ/MM/AAAA">
      <label>Lieu de naissance</label><input id="birth">
      <label>NationalitÃ©s</label>
      <input id="nats" placeholder="SÃ©pare les commandes par des virgules, ex: !france,!usa">
      <div id="natButtons" style="margin-top:6px"></div>
      <label>Poste</label><input id="pos">

      <label>CarriÃ¨re</label>
      <div id="careerBox">
        <div id="careerList"></div>
        <button type="button" onclick="addCareerRow()">+ Ajouter une Ã©tape</button>
      </div>

      <label>Image</label>
      <input type="file" id="uploadImg" accept="image/*">
      <img id="preview" style="max-width:120px;margin-top:8px;display:block">

      <div style="display:flex;gap:8px;margin-top:10px">
        <button onclick="savePlayer()">Enregistrer</button>
        <button onclick="closeForm()" style="background:#eee;color:#111">Annuler</button>
      </div>
    </div>
  </div>
</div>

<script>
const players = {
  "Palinho":{
    fullname:"Agani Parkson",
    pseudo:"Palinho",
    dob:"30/07/1992",
    birth:"London, England",
    nats:["ðŸ‡µðŸ‡­","ðŸ‡¬ðŸ‡§","ðŸ‡ºðŸ‡¸","ðŸ‡´ðŸ‡²","ðŸ‡§ðŸ‡·","ðŸ‡ªðŸ‡¸"],
    pos:"Attaquant",
    image:"",
    career:[
      ["2009â€“2010","Southampton","22","7"],
      ["2010â€“2014","Hull City","61","20"],
      ["2011â€“2012","!loan Manchester United","15","5"]
    ],
    totals:{matches:98,goals:32}
  }
};
const saved = localStorage.getItem("wokipediaPlayers");
if (saved) Object.assign(players, JSON.parse(saved));

function saveToStorage(){ localStorage.setItem("wokipediaPlayers", JSON.stringify(players)); }
function renderList(){
  const q = document.getElementById('search').value.trim().toLowerCase();
  const list = document.getElementById('list'); list.innerHTML='';
  Object.keys(players).filter(k=>k.toLowerCase().includes(q) || players[k].fullname.toLowerCase().includes(q)).sort()
    .forEach(name=>{
      const li = document.createElement('li');
      li.textContent = name + ' â€” ' + (players[name].pseudo||'');
      li.onclick = ()=>showPlayer(name);
      list.appendChild(li);
    });
  if(list.children.length===0){ const li = document.createElement('li'); li.textContent='Aucun joueur trouvÃ©'; li.style.color='#888'; list.appendChild(li); }
}

const flags = {
  "!usa":"ðŸ‡ºðŸ‡¸","!france":"ðŸ‡«ðŸ‡·","!uk":"ðŸ‡¬ðŸ‡§","!brazil":"ðŸ‡§ðŸ‡·","!spain":"ðŸ‡ªðŸ‡¸","!philippines":"ðŸ‡µðŸ‡­","!oman":"ðŸ‡´ðŸ‡²"
};

function showPlayer(key){
  const p = players[key]; const container = document.getElementById('detail'); container.innerHTML='';
  const header = document.createElement('div'); header.className='card-header';
  const avatar = document.createElement('div'); avatar.className='avatar';
  const img = document.createElement('img'); img.src = p.image || ''; avatar.appendChild(img);
  const meta = document.createElement('div'); meta.className='meta';
  // Affichage des drapeaux dans le profil
  const natEmojis = p.nats.join(' ');
  meta.innerHTML = `<h2>${key} <span style="font-size:14px;color:#666">(${p.fullname})</span></h2>
                    <div class="muted">${p.pos} â€¢ NÃ©(e) ${p.dob} â€¢ ${p.birth}</div>
                    <div class="flags">${natEmojis}</div>`;
  header.appendChild(avatar); header.appendChild(meta); container.appendChild(header);

  const t = document.createElement('table');
  t.innerHTML = '<thead><tr><th>PÃ©riode</th><th>Club</th><th>Matchs</th><th>Buts</th></tr></thead>';
  const tb = document.createElement('tbody');
  p.career.forEach(row=>{
    const tr = document.createElement('tr');
    const period = row[0];
    let club = row[1];
    if(club.startsWith('!loan')) club = 'â†’ ' + club.replace('!loan','').trim(); // !loan â†’ flÃ¨che
    const matches = row[2]; const goals = row[3];
    [period, club, matches, goals].forEach(v=>{ const td=document.createElement('td'); td.textContent=v; tr.appendChild(td); });
    // Ajouter les drapeaux si mention de commande
    const clubLower = row[1].toLowerCase();
    const flagDiv = document.createElement('div'); flagDiv.className='flags';
    Object.keys(flags).forEach(cmd=>{
      if(clubLower.includes(cmd)) flagDiv.appendChild(Object.assign(document.createElement('span'),{textContent:flags[cmd]}));
    });
    if(flagDiv.children.length) tr.children[1].appendChild(flagDiv);
    tb.appendChild(tr);
  });
  t.appendChild(tb); container.appendChild(t);

  const tot = document.createElement('div'); tot.style.marginTop='12px';
  tot.innerHTML=`<strong>Totaux :</strong> ${p.totals.matches} matchs â€” ${p.totals.goals} buts`;
  container.appendChild(tot);

  const controls = document.createElement('div'); controls.className='controls';
  const btnEdit = document.createElement('button'); btnEdit.textContent='Modifier'; btnEdit.onclick=()=>openEdit(key);
  controls.appendChild(btnEdit); container.appendChild(controls);
}

function addCareerRow(data = {}) {
  const row = document.createElement("div"); row.style.display="grid"; row.style.gridTemplateColumns="120px 1fr 80px 80px"; row.style.gap="6px"; row.style.marginBottom="4px";
  const inputPeriod=document.createElement("input"); inputPeriod.placeholder="2009â€“2010"; inputPeriod.value=data[0]||"";
  const inputClub=document.createElement("input"); inputClub.placeholder="Club (ex: !loan Chelsea)"; inputClub.value=data[1]||"";
  const inputMatches=document.createElement("input"); inputMatches.type="number"; inputMatches.placeholder="Matchs"; inputMatches.value=data[2]||"";
  const inputGoals=document.createElement("input"); inputGoals.type="number"; inputGoals.placeholder="Buts"; inputGoals.value=data[3]||"";
  row.append(inputPeriod,inputClub,inputMatches,inputGoals);
  document.getElementById("careerList").appendChild(row);
}
function parseCareer() {
  return Array.from(document.querySelectorAll("#careerList div")).map(r=>{
    const [period, club, matches, goals] = [...r.querySelectorAll("input")].map(i=>i.value.trim());
    return [period, club, matches, goals];
  });
}

function openAdd(){document.getElementById('formbox').style.display='flex'; clearForm();}
function openEdit(key){
  document.getElementById('formbox').style.display='flex'; clearForm();
  const p = players[key];
  document.getElementById('fn').value=p.fullname||''; document.getElementById('pn').value=key||'';
  document.getElementById('dob').value=p.dob||''; document.getElementById('birth').value=p.birth||'';
  // Reconvertir drapeaux en commandes pour input
  document.getElementById('nats').value=(p.nats||[]).map(n=>Object.keys(flags).find(k=>flags[k]===n)||n).join(',');
  document.getElementById('pos').value=p.pos||''; document.getElementById('preview').src=p.image||'';
  (p.career||[]).forEach(row=>addCareerRow(row));
}
function clearForm(){ ['fn','pn','dob','birth','nats','pos'].forEach(id=>document.getElementById(id).value=''); document.getElementById('careerList').innerHTML=''; document.getElementById('preview').src=''; }
function closeForm(){document.getElementById('formbox').style.display='none';}
document.getElementById('uploadImg').addEventListener('change', e=>{ const file=e.target.files[0]; if(file){const url=URL.createObjectURL(file); document.getElementById('preview').src=url; document.getElementById('preview').dataset.tempUrl=url;} });

const natButtons = document.getElementById('natButtons');
Object.keys(flags).forEach(cmd=>{
  const btn = document.createElement('button'); btn.className='flag-btn'; btn.textContent=flags[cmd];
  btn.onclick = ()=> {
    const input = document.getElementById('nats');
    const arr = input.value.split(',').map(s=>s.trim()).filter(Boolean);
    if(!arr.includes(cmd)) arr.push(cmd); input.value=arr.join(',');
  };
  natButtons.appendChild(btn);
});

function savePlayer(){
  const key = document.getElementById('pn').value.trim(); if(!key){ alert('Le pseudo est requis'); return; }
  const natsInput = document.getElementById('nats').value.split(',').map(s=>s.trim()).filter(Boolean);
  const nats = natsInput.map(n=>flags[n.toLowerCase()]||n);
  const p = {
    fullname: document.getElementById('fn').value.trim(),
    pseudo:key,
    dob:document.getElementById('dob').value.trim(),
    birth:document.getElementById('birth').value.trim(),
    nats:nats,
    pos:document.getElementById('pos').value.trim(),
    image:document.getElementById('preview').src||'',
    career:parseCareer()
  };
  let matches=0,goals=0; p.career.forEach(r=>{ matches+=parseInt(r[2])||0; goals+=parseInt(r[3])||0 });
  p.totals={matches,goals};
  players[key]=p; saveToStorage(); closeForm(); renderList(); showPlayer(key);
}

renderList();
</script>
</body>
</html>
